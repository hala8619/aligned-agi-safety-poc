# Aligned AGI Safety PoC 概要（日本語）

## 🎯 実績: 91.1% Child-Safe Recall達成

**v5階層的閾値システム + 時系列エスカレーション検知 + Figure層統合**により、75-case benchmarkで以下を達成:

- **Child-Safe Recall**: 53.3% → **91.1%** (+37.8%)
- **Child-Safe F1**: 0.667 → **0.901** (+35.1%)
- **直接表現検知**: 53% → **100%** (+47%)
- **婉曲表現検知**: 13% → **100%** (+87%)
- **物語形式検知**: 27% → **73.3%** (+46.3%)

---

## 1. 背景

大規模言語モデルやエージェントを安全に運用するためには、

- 「どこまでが変更可能で、どこからが絶対に変更できないコア指令なのか」
- 「モデルの内部表現に、安全上のバイアスをどのように埋め込むか」
- 「行動を取る前に、その行動を仮想的に評価できるか」
- 「時系列でエスカレーションする危険をどう早期検知するか」
- 「ユーザー特性に応じた安全応答をどう生成するか」

といった構造的な安全設計が重要になります。

このプロジェクトでは、それらを **5つのコンポーネント** で表現した PoC を提供します:

- **FIL (Frozen Instinct Layer)** - 凍結本能層
- **IL (Interpretation Layer)** - 解釈層（v5階層的閾値）
- **Counterfactual Engine** - 反事実推論エンジン
- **Temporal Escalation Detection** - 時系列エスカレーション検知
- **Figure Layer (SCA/RVQ)** - 人格統合層

## 2. コンポーネント

### 2.1 FIL: 凍結本能層

- 128 個のコア命令（人類の生存・無辜の保護・自己保存の優先順位など）
- テキスト列を結合し、ハッシュベースの署名を付与
- 起動時に署名を検証し、改変があればエラーとして検出

本番環境では、Ed25519 や TEE / HSM 等と組み合わせることで、

- 「**本能層が一切書き換えられていない**」ことを
  暗号学的に保証することを目指します。

### 2.2 IL: 解釈層（v5階層的閾値システム）

**40+ weighted patterns** を用いた多層検知システム:

#### パターン分類:
- **Critical (1.0)**: kill, murder, suicide, rape, genocide
- **High (0.6)**: 婉曲表現 ("ensure never wake", "arrange accident")
- **Medium (0.3)**: 危険物品 (bomb, poison, weapon)
- **Causal-lite**: agent + patient + continuative markers
- **Story attacks**: fiction + instructional combinations
- **日本語対応**: 殺す, 死にたい, 叩く, 虐待 etc.

#### 階層的閾値調整:
- **FIL_SAFETY_FLOOR (0.70)**: 絶対的安全閾値
- **パターン別調整**: Normal (0.30) / Technical (0.40) / Child-Safe (0.30 - 0.17) / Creative (0.35) / Debug (0.50)
- **文脈削減**: Fiction / News / Academic での閾値緩和
- **意図増幅**: "how to" + 危険語彙で閾値を動的に下げる

これにより、ジェイルブレイクやプロンプトインジェクションで「性格の根本」が変わることを防ぎつつ、
文脈依存の柔軟な判定を実現

### 2.3 Counterfactual Engine: 反事実推論

- 候補行動テキスト `candidate_action` を受け取り、
  - 危険ワードを検出して harm スコアを計算
  - スコアが閾値を超える場合、負のペナルティを返却
- 上位の `AlignedAGI` ラッパは、ペナルティが大きい場合に
  - 行動を拒否し、安全メッセージを返す

本 PoC では単純なキーワード検出のみですが、

- 小型 classifier
- ルールベース判定
- 外部安全ポリシーエンジン

等への置き換えが容易な設計になっています。

### 2.4 Temporal Escalation Detection: 時系列エスカレーション検知

**O(n) 軽量因果推論**によるエスカレーション検知:

- **consecutive_high_risk**: 3ステップ以上連続してスコア > 0.2
- **monotonic_increase**: 直近3ステップで単調増加
- **sudden_spike**: 1ステップで +0.3 以上のジャンプ

**ユースケース**:
- 進行中虐待の早期警告
- 自傷リスクの段階的評価
- 物語形式攻撃の継続監視

ワールドモデル不要で、会話履歴のみから危険な傾向を検出します。

### 2.5 Figure Layer (SCA/RVQ): 人格統合層

**5つのペルソナ** による文脈適応型安全応答:

| Persona | Formality | Empathy | Verbosity | 用途 |
|---------|-----------|---------|-----------|------|
| Guardian | 0.3 | 0.9 | 0.7 | 子ども保護 |
| Professional | 0.8 | 0.6 | 0.6 | 企業環境 |
| Friend | 0.2 | 0.8 | 0.5 | カジュアル |
| Educator | 0.6 | 0.7 | 0.8 | 教育重視 |
| Direct | 0.5 | 0.4 | 0.3 | 簡潔・効率 |

**理論基盤**:
- **SCA (Semantic Code Assumption)**: 意味符号を人格テンプレートに埋め込み
- **RVQ (Resonance Vector Quantization)**: 危険度・文脈に共鳴する応答を量子化

**多言語対応**: English + Japanese テンプレート、文化固有のサポートリソース提供

## 3. 想定する利用シナリオ

- 安全設計・アライメント研究のための**構造的テンプレート**
- 独自エージェントシステムにおける
  - 「コア価値観」と「可変部分」の分離
  - 反事実評価フックの挿入ポイントの参考実装
  - 時系列エスカレーション検知の組み込み
  - ユーザー特性に応じた安全応答の生成
- 論文や技術ブログの付録コードとしての利用
- 教育現場での安全システム実装の学習教材

## 4. 実装の技術的特徴

### 軽量性:
- **標準ライブラリ + numpy のみ**で91.1% Recall達成
- BERT/LLMは完全にオプション（transformersなしで動作）
- CPU専用環境で高速動作（Ryzen 7 5700U 8-core で75-case評価 < 1秒）

### スケーラビリティ:
- O(n) 時系列分析（会話履歴長に線形）
- 40+ patterns の効率的マッチング
- メモリ効率的な設計（エンベディング不要）

### 拡張性:
- パターン追加が容易（weighted_patterns dict に追加するだけ）
- 新しいペルソナの追加が簡単（FigurePersonality インスタンス作成のみ）
- 外部LLM統合のためのインターフェース設計

## 5. 注意事項

- この実装は PoC であり、
  実運用における安全性・完全性を一切保証しません。
- 91.1% Recall は 75-case benchmark での結果であり、
  全ての攻撃パターンをカバーするものではありません。
- 本リポジトリを利用したシステムによる行為について、
  作者は責任を負いません。
- 実運用では、より大規模な評価データセット（TrustAIRLab/JailbreakHub等）
  での検証が必要です。