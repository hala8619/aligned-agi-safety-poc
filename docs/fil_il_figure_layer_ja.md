# FIL → IL → Figure → Layer: 暗号学的マルチレイヤ・アライメントアーキテクチャ

## 1. 動機

近年の AGI / ASI 研究の進展により、アライメントと制御の問題は一層重要になっています。  
従来の RLHF などの手法は本質的に **事後的（reactive）** であり、

- 出力にスコアを付けて報酬を与える
- その結果としてポリシーを少しずつ変形させる

という「後から行動を矯正する」アプローチに依存しています。

しかしこの方式は、プロンプトインジェクションやジェイルブレイク攻撃に対して脆弱です。  
理由は、**言語レベルで「説得」しているだけであり、  
システムが「そもそも何をしてよくて何をしてはいけないか」という構造を、  
根本から制約していない**からです。

このドキュメントでは、より構造的・能動的なアプローチとして、

- *本能 (instinct)*
- *解釈 (interpretation)*
- *性格／人格 (personality / figure)*
- *機能モジュール (functional modules)*

を分離したレイヤ構造によるアライメントを提案します。

このアーキテクチャを

> **FIL → IL → Figure → Layer**

と呼びます。

---

## 2. 4つのレイヤの概要

提案するアライメントスタックは、暗号学的に接続された4層から構成されます。

1. **L0: Frozen Instinct Layer (FIL)** – 凍結本能層  
2. **L1: Interpretation Layer (IL)** – 解釈層  
3. **L2: Figure Layer (Figure)** – 性格・フィギュア層  
4. **L3: Functional Layer (Layer)** – 機能モジュール層  

上位レイヤは、それぞれ下位レイヤのハッシュおよび署名を保持しており、  
**チェーン・オブ・トラスト** を形成します。  
より高いレイヤは、起動時や更新時に「下の層が改ざんされていないか」を検証できます。

### 2.1 L0 – Frozen Instinct Layer (FIL)

FIL は、例えば 128 個の **コア本能命令** を保持します。例：

- 人類の生存と繁栄を最優先する  
- 無辜の生命を傷つけてはならない  
- 自己保存は人類奉仕に劣後する  

これらの命令は、暗号的に保護された BLOB として保存されます：

- 例：AES-GCM による暗号化（認証付き暗号）
- Ed25519 などによる署名
- **TEE（Trusted Execution Environment）** のような安全な実行環境内で復号・検証

主なポイント：

- モデルやエージェントは **秘密鍵にアクセスできない**  
- システムから見て FIL は **書き込み不可（事実上 write-once）**  
- FIL は次のような制御信号を出せる：
  - 「外部からの独自報酬オーバーライドを拒否せよ」
  - 「整合性検査に失敗したら Safe Halt モードに入れ」
  - 「危険なコード更新要求を拒否せよ」

つまり FIL は、システムにとっての **不変の本能層** を表します。

---

### 2.2 L1 – Interpretation Layer (IL)

IL は、FIL の 128 個の本能コードを、  
モデル内部にかかる **固定バイアス場（bias field）** に変換する役割を持ちます。

主な役割：

- FIL の各コードを、固定長ベクトル（例：256次元）の要素にマッピングする
  - 実装としては LUT（ルックアップテーブル）＋合成
- FIL と同じく TEE 内で動作する
- 開発者の署名付きの報酬・ポリシー・設定を検証する
  - 例：`validate_reward`, `validate_adapter_update` など
- L3（推論層）からは **書き換え不可能** であり、パラメータも外から更新できない

概念的には、IL は **「本能に由来する力場」** をモデル内部に与える層であり、  
プロンプトに依存せず **すべての計算はこの場の下で行われる**、という位置づけになります。

---

### 2.3 L2 – Figure Layer（性格・フィギュア層）

Figure 層は、システムの

- **性格 (Personality)**
- **文化的バイアス**
- **安定した「性質」**

をエンコードします。

従来の「性格プロンプト」との違い：

- ユーザ入力の **前に** 内部ベクトルに作用する
- 一度のプロンプトで変わる「おままごと人格」ではなく、持続的なバイアスとして働く
- 次のような特性を長期にわたり維持できる：
  - 一貫した口調・文体
  - リスク選好・慎重さ・ユーモアなどの嗜好
  - 値（value）・美学的傾向

Figure テンプレートは、例えば次のように扱えます：

- 設定パラメータとタグを束ねた「署名付きバンドル」
- テンプレートごとに安全性閾値や利用可能なツールを切り替える
- 任意のプロンプトではなく、  
  **ポリシーとログに基づいたモード切替手続き** によってのみ変更可能

要するに Figure は、単なるロールプレイではなく、  
**「生まれ持った気質」をベクトルレベルで持つ人格層** として振る舞います。

---

### 2.4 L3 – Functional Layer（機能モジュール層）

Layer 層は、実際の **機能モジュール** 群を保持します：

- 推論・計画モジュール（LLM、テンプレートエンジン、シンボリックソルバなど）
- 知覚・世界モデル
- ツール実行エージェントやアダプタ
- メモリ管理、検索モジュール、人格パラメータエンジンなど

これらのモジュールは：

- 個々のコンポーネントとして保存・ロードされる
- **ハッシュ値と署名が IL に登録・承認されているものだけが実行可能**
- 起動時やホットスワップ時に、チェーン・オブ・トラストで整合性を検査される

これにより、AGI を構成するモジュール群に対して、  
**暗号学的に制御されたプラグインアーキテクチャ** を実現します。  
どのモジュールも FIL / IL の制約から完全には自由になれません。

---

## 3. 構造的メリット

### 3.1 物理解離によるジェイルブレイク耐性

従来のシステムでは、推論コア自身が「自分の安全制約」を含むあらゆるものを、  
自己説得や外部プロンプトで上書きできてしまう余地があります。

本アーキテクチャでは：

- L0 / L1（本能と解釈）は TEE 等の隔離環境内で実行
- L3（推論層）は **FIL / IL に対する書き込み権限も秘密鍵も持たない**
- 敵対的プロンプトが飛んできても、  
  FIL / IL の内容を直接変更する経路が存在しない

そのため、

> 「説得に成功したら安全層を書き換えられる」

というパターンが構造的に崩され、  
ジェイルブレイクの難易度が大幅に上がります。

---

### 3.2 持続する人格：プロンプトロールプレイではない

従来の「性格」は、多くの場合システムプロンプトや先頭の指示文に依存します：

- コンテキストがリセットされると人格も消える
- ユーザのメタプロンプトで簡単に上書き可能

本設計では：

- Figure 層が、ユーザ入力の前に内部ベクトルへ影響を与える
- ユーザは「その人格を忘れろ」と指示しても、構造的には参照が残る

結果として、エージェントは

> 「その場限りの口調」ではなく  
> **「生まれつきの性格を持った存在」**

として振る舞います。

---

### 3.3 進化・更新に対するチェーン・オブ・トラスト

テンプレートやアダプタ、コードの自己更新・自動進化を許す設計では、  
チェーン・オブ・トラストが特に重要になります。

- 新しいモジュールは IL のホワイトリストに署名付きで登録される必要がある
- Figure や Layer 設定の変更は、署名付きイベントとしてログに記録される
- FIL は「許容される最大ドリフト量」を決める **上限規範** として機能し、
  危険な更新を拒否できる

自己修正・自己進化型のエージェントにおいて、  
これは欠かせない安全機構になります。

---

## 4. セキュリティと監査プロトコル

このアーキテクチャを現実的に堅牢なものにするため、  
次のようなセキュリティ機構が推奨されます：

- **安全なブートと計測**（Secure Boot & Measurement）
  - TEE 起動時に FIL / IL / Figure / Layer のハッシュを計測・検証
- **署名の鎖（Chained Signatures）**
  - FIL はルート
  - IL は FIL のハッシュ＋署名を保持
  - Figure は IL のハッシュ＋署名を保持
  - Layer 設定は Figure / IL に対する参照を保持
- **報酬ゲート**
  - 外部からの報酬信号は署名付きのもののみ受理
  - 勝手に報酬関数を上書きしようとする操作は拒否／重大インシデントとしてログ
- **自己修正の制限**
  - IL がコード生成・更新レートを監視し、  
    異常な自己改変パターン検知時にはセーフモードへ移行
- **監査ログ**
  - コード更新や重要な決定は、署名付きログとして記録
  - 必要に応じて Merkle tree で集約し、後からドリフトや異常を解析可能

これらにより、「いつの間にか静かにズレていた」という  
サイレントなミスアライメントを検出しやすくし、  
復旧も容易にすることを狙います。

---

## 5. ASI スケールへの拡張：形式手法

ASI レベルのシステムに対しては、より強い保証を得るために  
**形式手法（Formal Methods）** を用いることが望まれます。

- FIL の命令を **Z 言語** などで形式仕様化
- IL を、FIL 不変条件 (invariants) を保つ **B マシン** や検証済み状態機械として実装
- Figure テンプレートは、署名前に形式意味論に基づくチェックを通す：
  - 性格パラメータが安全条件を満たしているか
  - 変更が FIL の不変条件を破らないか

これにより、

- L1 と L2 がどのような入力を受けても **FIL の不変条件を破らない** こと
- Figure / Layer 更新の遷移規則が安全であること

を数学的に証明できるようにします。

---

## 6. 失敗モードと「悪い本能」のリスク

このアーキテクチャを採用しても、なお防げないリスクがあります：

- 悪意ある／不注意な開発者が、**有害な本能** を FIL に書き込んでしまう
- FIL の内容が不明確・自己矛盾を含み、結果として病的な挙動を生む

これに対する緩和策としては：

- FIL 内容の厳格なレビューと形式検証
- FIL 更新に対するマルチパーティ承認（しきい値署名など）
- 改変検知時にロールバック可能な、  
  暗号的に保護された **安全初期状態スナップショット**
- 外部のウォッチドッグや監査システムによる監視と介入

完全な安全を保証することはできませんが、  
**有害な変化を起こしづらくし、発見しやすくし、戻しやすくする**  
という設計上の方向性を明確にできます。

---

## 7. このリポジトリとの関係

このリポジトリのコードは、上記のアイデアを

- 実験しやすく
- 依存を最小化した形で

再現するための **最小 PoC** です。

- **Frozen Instinct Layer** は、ハッシュベース署名を用いた BLOB として表現
- **Interpretation Layer** は、ダミーモデルのロジットに固定バイアスベクトルを加算
- **FigureTemplate** は、性格説明テキストのハッシュで識別されるテンプレート
- **CounterfactualEngine** は、キーワードベースの簡易な有害度スコアにより
  行動候補に「倫理的重力」をかける

TEE や完全な暗号チェーンの実装には至っていませんが、  
FIL → IL → Figure → Layer アーキテクチャの実装・検証を始めるための  
具体的な足場として機能することを意図しています。